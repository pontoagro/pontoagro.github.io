"function"!=typeof String.prototype.replaceSpecialChars&&(String.prototype.replaceSpecialChars=function(){var t={"ç":"c","æ":"ae","œ":"oe","á":"a","é":"e","í":"i","ó":"o","ú":"u","à":"a","è":"e","ì":"i","ò":"o","ù":"u","ä":"a","ë":"e","ï":"i","ö":"o","ü":"u","ÿ":"y","â":"a","ê":"e","î":"i","ô":"o","û":"u","å":"a","ã":"a","ø":"o","õ":"o",u:"u","Á":"A","É":"E","Í":"I","Ó":"O","Ú":"U","Ê":"E","Ô":"O","Ü":"U","Ã":"A","Õ":"O","À":"A","Ç":"C"};return this.replace(/[\u00e0-\u00fa]/g,function(e){return void 0!==t[e]?t[e]:e})}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),jQuery.fn.OrionSmartResearch=function(e){function n(e,t){"object"==typeof console&&console.log("[Smart Research - "+(t||"Erro")+"] "+e)}var r=jQuery(this),t={pageLimit:null,loadContent:".prateleira[id^=ResultItems]",shelfClass:".prateleira",filtersMenu:".search-multiple-navigator",linksMenu:".search-single-navigator",menuDepartament:".navigation .menu-departamento",mergeMenu:!0,insertMenuAfter:".search-multiple-navigator h3:first",emptySearchElem:jQuery('<div class="vtexsr-emptySearch"></div>'),elemLoading:'<div id="scrollLoading">Carregando ... </div>',returnTopText:'<span class="text">voltar ao</span><span class="text2">TOPO</span>',emptySearchMsg:"<h3>Esta combinação de filtros não retornou nenhum resultado!</h3>",filterErrorMsg:"Houve um erro ao tentar filtrar a página!",searchUrl:null,usePopup:!1,showLinks:!0,popupAutoCloseSeconds:3,filterScrollTop:function(e){return e.top-20},callback:function(){},getShelfHeight:function(e){return e.scrollTop()+e.height()},shelfCallback:function(){},ajaxCallback:function(){},emptySearchCallback:function(){},authorizeScroll:function(){return!0},authorizeUpdate:function(){return!0},labelCallback:function(e){}},i=jQuery.extend(t,e),a=jQuery(""),o=jQuery(i.elemLoading),l=2,s=!0,u=jQuery(window),c=(jQuery(document),jQuery("html,body")),p=jQuery("body"),f="",d="",h="",m=!1,g=jQuery(i.loadContent),y=jQuery(i.filtersMenu),v={requests:0,filters:0,isEmpty:!1},j={},C={getUrl:function(e){return e?f.replace(/PageNumber=[0-9]*/,"PageNumber="+l):(h+d).replace(/PageNumber=[0-9]*/,"PageNumber="+Q)},getSearchUrl:function(){var e,t,r;return jQuery("script:not([src])").each(function(){if(t=jQuery(this)[0].innerHTML,r=/\/buscapagina\?.+&PageNumber=/i,-1<t.search(/\/buscapagina\?/i))return e=r.exec(t),!1}),void 0!==e&&void 0!==e[0]?e[0]:(n("Não foi possível localizar a url de busca da página.\n Tente adicionar o .js ao final da página. \n[Método: getSearchUrl]"),"")},scrollToTop:function(){var e=p.find("#returnToTop");e.length<1&&(e=jQuery('<div id="returnToTop"><a href="#">'+i.returnTopText+'<span class="arrowToTop"></span></a></div>'),p.append(e));var t=u.height();u.bind("resize",function(){t=u.height()}),u.bind("scroll",function(){u.scrollTop()>t?e.stop(!0).fadeTo(300,1,function(){e.show()}):e.stop(!0).fadeTo(300,0,function(){e.hide()})}),e.bind("click",function(){return c.animate({scrollTop:0},"slow"),!1})},infinitScroll:function(){var e=(p.find(".pager:first").attr("id")||"").split("_").pop(),r=null!==i.pageLimit?i.pageLimit:window["pagecount_"+e],a=!0;void 0===r&&(r=99999999),u.bind("scroll",function(){var t,e=jQuery(this);if(!(!m&&l<=r&&s&&i.authorizeScroll(v)))return!1;e.scrollTop()+e.height()>=i.getShelfHeight(g)&&a&&((t=g.find(i.shelfClass).filter(":last")).after(o),a=!1,E=jQuery.ajax({url:C.getUrl(!0),success:function(e){e.trim().length<1?(s=!1,n("Não existem mais resultados a partir da página: "+(l-1),"Aviso")):t.after(e),a=!0,o.remove(),v.requests++,i.ajaxCallback(v)}}),l++)})}},f=h=null!==i.searchUrl?i.searchUrl:C.getSearchUrl();if(r.length<1)return n("Nenhuma opção de filtro encontrada","Aviso"),i.showLinks&&jQuery(i.linksMenu).css("visibility","visible").show(),C.infinitScroll(),C.scrollToTop(),r;if(g.length<1)return n("Elemento para destino da requisição não foi encontrado \n ("+g.selector+")"),!1;y.length<1&&n("O menu de filtros não foi encontrado \n ("+y.selector+")"),document.location.href;var b=jQuery(i.linksMenu),S=jQuery('<div class="vtexSr-overlay"></div>'),x=jQuery(i.menuDepartament),T=g.offset(),Q=1,M=null,E=null;i.emptySearchElem.append(i.emptySearchMsg),g.before(S);var k={exec:function(){k.setFilterMenu(),k.fieldsetFormat(),r.each(function(){var e=jQuery(this),t=e.parent();e.is(":checked")&&(d+="&"+(e.attr("rel")||""),t.addClass("sr_selected")),k.adjustText(e),t.append('<span class="sr_box"></span><span class="sr_box2"></span>'),e.bind("change",function(){k.inputAction(),e.is(":checked")?k.addFilter(e):k.removeFilter(e),v.filters=r.filter(":checked").length})}),""!==d&&k.addFilter(a)},mergeMenu:function(){if(!i.mergeMenu)return!1;var e=x;e.insertAfter(i.insertMenuAfter),k.departamentMenuFormat(e)},mergeMenuList:function(){var t=0;y.find("h3,h4").each(function(){var e=b.find("h3,h4").eq(t).next("ul");e.insertAfter(jQuery(this)),k.departamentMenuFormat(e),t++})},departamentMenuFormat:function(e){e.find("a").each(function(){var e=jQuery(this);e.text(k.removeCounter(e.text()))})},fieldsetFormat:function(){j.fieldsetCount=0,j.tmpCurrentLabel={},y.find("fieldset").each(function(){var n=jQuery(this),e=n.find("label"),o="filtro_"+(n.find("h5:first").text()||"").toLowerCase().replaceSpecialChars().replace(/\s/g,"-");j[o]={},e.length<1?n.hide():(n.addClass(o),e.each(function(e){var t=jQuery(this),r=t.find("input").val()||"",a="sr_"+r.toLowerCase().replaceSpecialChars().replace(/\s/g,"-");j.tmpCurrentLabel={fieldsetParent:[n,o],elem:t},j[o][e.toString()]={className:a,title:r},t.addClass(a).attr({title:r,index:e}),i.labelCallback(j)}),j.fieldsetCount++)})},inputAction:function(){null!==E&&E.abort(),null!==M&&M.abort(),l=2,s=!0},addFilter:function(e){d+="&"+(e.attr("rel")||""),S.fadeTo(300,.6),f=C.getUrl(),M=jQuery.ajax({url:f,success:k.filterAjaxSuccess,error:k.filterAjaxError}),e.parent().addClass("sr_selected")},removeFilter:function(e){var t=e.attr("rel")||"";S.fadeTo(300,.6),""!==t&&(d=d.replace("&"+t,"")),f=C.getUrl(),M=jQuery.ajax({url:f,success:k.filterAjaxSuccess,error:k.filterAjaxError}),e.parent().removeClass("sr_selected")},filterAjaxSuccess:function(e){e=jQuery(e);S.fadeTo(300,0,function(){jQuery(this).hide()}),k.updateContent(e),v.requests++,i.ajaxCallback(v),c.animate({scrollTop:i.filterScrollTop(T||{top:0,left:0})},600)},filterAjaxError:function(){S.fadeTo(300,0,function(){jQuery(this).hide()}),alert(i.filterErrorMsg),n("Houve um erro ao tentar fazer a requisição da página com filtros.")},updateContent:function(e){if(m=!0,!i.authorizeUpdate(v))return!1;var t=e.filter(i.shelfClass),e=g.find(i.shelfClass);(0<e.length?e:i.emptySearchElem).slideUp(600,function(){jQuery(this).remove(),i.usePopup?p.find(".boxPopUp2").vtexPopUp2():i.emptySearchElem.remove(),0<t.length?(t.hide(),g.append(t),i.shelfCallback(),t.slideDown(600,function(){m=!1}),v.isEmpty=!1):(v.isEmpty=!0,i.usePopup?i.emptySearchElem.addClass("freeContent autoClose ac_"+i.popupAutoCloseSeconds).vtexPopUp2().stop(!0).show():(g.append(i.emptySearchElem),i.emptySearchElem.show().css("height","auto").fadeTo(300,.2,function(){i.emptySearchElem.fadeTo(300,1)})),i.emptySearchCallback(v))})},adjustText:function(e){var t=e.parent(),r=t.text();qtt="",r=k.removeCounter(r),t.text(r).prepend(e)},removeCounter:function(e){return e.replace(/\([0-9]+\)/gi,function(e){return qtt=e.replace(/\(|\)/,""),""})},setFilterMenu:function(){0<y.length&&(b.hide(),y.show())}};p.hasClass("departamento")?k.mergeMenu():(p.hasClass("categoria")||p.hasClass("resultado-busca"))&&k.mergeMenuList(),k.exec(),C.infinitScroll(),C.scrollToTop(),i.callback(),y.css("visibility","visible")};