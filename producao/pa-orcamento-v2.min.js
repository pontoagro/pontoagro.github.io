!function(){try{let l={init:()=>{l.applyDataTable(),l.applyValidate(),l.applyMaskInPhone(),l.submitForm(),l.bringData()},ajaxStop:()=>{},applyDataTable:()=>{let n=$("#pa-tabela-items").DataTable({searching:!1,paging:!1,info:!1,dom:"<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>\n                <'row'<'col-sm-12'tr>>\n                <'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>\n                <'row'<'py-4 w-100 d-flex justify-content-end'B>>",buttons:[{extend:"pdfHtml5",text:"Exportar Planilha para PDF",orientation:"landscape",className:"btn-info mr-2"},{extend:"excelHtml5",text:"Exportar lista para Excel",className:"btn-secondary"}],language:{url:"//cdn.datatables.net/plug-ins/1.10.25/i18n/Portuguese-Brasil.json"}});$("#pa-btn-add-item").on("click",t=>{t.preventDefault();let e=$("#pa-inputCodeProduct"),a=$("#pa-inputDescription"),o=$("#pa-inputQtt");0!=e.val().length&&0!=a.val().length&&0!=o.val().length?(n.row.add([e.val(),a.val(),o.val(),'<button class="pa-delete-product"><i class="fas fa-trash-alt"></i></button>']).draw(),e.val(""),a.val(""),o.val("")):alert("Ops! Faltou algum campo a ser preenchindo.")}),$(document).on("click",".pa-delete-product",t=>{t.preventDefault(),$(t.target).is(".pa-delete-product")?n.row($(t.target).parent()).remove().draw():$(t.target).is(".fas.fa-trash-alt")&&n.row($(t.target).parent().parent()).remove().draw()})},applyValidate:()=>{$("#pa-form-orcamento").validate({rules:{nome:{required:!0},email:{required:!0,email:!0},telefone:{required:!0}}})},applyMaskInPhone:()=>{let n=t=>11===t.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009";$("#pa-inputTelefone").mask(n,{onKeyPress:function(t,e,a,o){a.mask(n.apply({},arguments),o)}})},submitForm:()=>{let e=$("#pa-form-orcamento");e.on("submit",t=>{t.preventDefault();t=e.serializeObject();e[0].checkValidity()&&(console.log("Formulario Submetido"),console.log(t),$.ajax({type:"POST",url:"/api/dataentities/LO/documents",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(t)}).done(function(t){console.log("Dados Disparados!");let e=t.DocumentId,a=document.getElementById("pa-inputArquivo").files[0],o=new FormData;o.append(a.name.replace("listaprodutos",""),a),$.ajax({type:"POST",url:"/api/dataentities/LO/documents/"+e+"/listaprodutos/attachments",crossDomain:!0,data:o,processData:!1,contentType:!1,mimeType:"multipart/form-data",headers:{Accept:"application/vnd.vtex.ds.v10+json"}}).done(function(t){console.log("Planilha enviada!"),swal({title:"Orçamento enviado com sucesso",text:"Entraremos em contato o mais breve possível.",icon:"success"}).then(()=>{location.reload()})})}))})},bringData:()=>{let e,t=$("#pa-inputCodeProduct"),a=$("#pa-inputDescription"),o=$("#pa-list-code-product"),n=$("#pa-list-description");t.on("keyup",function(){let t=$(this).val();if(!t.length)return o.empty(),void o.hide();clearTimeout(e),e=setTimeout(()=>{l.getSearchResulted(t,"",o)},300)}),a.on("keyup",function(){let t=$(this).val();if(!t.length)return n.empty(),void n.hide();clearTimeout(e),e=setTimeout(()=>{l.getSearchResulted(t,"",n)})})},getSearchResulted:(t,e,a)=>{$.ajax({url:"/buscaautocomplete/",dataType:"json",data:{maxRows:12,productNameContains:t}}).done(function(t){t.itemsReturned.forEach(t=>{t.items.length&&(t=`<li><button data-id="${t.items[0].productId}">${t.name}</button></li>`,e+=t)}),a.html(`<ul class="list-results">${e}</ul>`),a.show(),l.selectResult()})},selectResult:()=>{let e=$("#pa-inputCodeProduct"),a=$("#pa-inputDescription"),o=$("#pa-list-code-product, #pa-list-description");$("#pa-list-code-product button").on("click",function(){var t=$(this).attr("data-id");$.ajax({type:"GET",url:`/api/catalog_system/pub/products/search?fq=productId:${t}`,dataType:"json"}).done(function(t){e.val(t[0].productReference),a.val(t[0].productName),o.empty(),o.hide()})}),$("#pa-list-description button").on("click",function(){var t=$(this).attr("data-id");$.ajax({type:"GET",url:`/api/catalog_system/pub/products/search?fq=productId:${t}`,dataType:"json"}).done(function(t){e.val(t[0].productReference),a.val(t[0].productName),o.empty(),o.hide()})})}};$(document).ready(l.init),$(document).ajaxStop(l.ajaxStop)}catch(t){console.log("Erro na instância do [Orcamento]: ",t)}}();